2025-08-25 19:38:23,973 - INFO - API startup successful - all required files found
2025-08-25 19:44:11,743 - INFO - === NEW REQUEST RECEIVED ===
2025-08-25 19:44:11,744 - INFO - comfyui_url: https://349405dc2eb3.ngrok-free.app
2025-08-25 19:44:11,744 - INFO - images_zip filename: input.zip
2025-08-25 19:44:11,744 - INFO - masks_zip filename: input_processed.zip
2025-08-25 19:44:11,744 - INFO - prompts_json filename: 6292393310444
2025-08-25 19:44:11,744 - INFO - Creating temporary directories...
2025-08-25 19:44:11,745 - INFO - Temp dir: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws
2025-08-25 19:44:11,745 - INFO - Input dir: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/input_images
2025-08-25 19:44:11,745 - INFO - Masks dir: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/masks
2025-08-25 19:44:11,745 - INFO - Output dir: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/output
2025-08-25 19:44:11,746 - INFO - Temporary directories created successfully
2025-08-25 19:44:11,746 - INFO - Starting ZIP extraction...
2025-08-25 19:44:11,746 - INFO - Attempting to extract images ZIP: input.zip
2025-08-25 19:44:11,746 - INFO - === ZIP EXTRACTION START ===
2025-08-25 19:44:11,746 - INFO - Filename: input.zip
2025-08-25 19:44:11,746 - INFO - Content type: application/zip
2025-08-25 19:44:11,746 - INFO - File size: 9553135
2025-08-25 19:44:11,747 - INFO - Reading file content...
2025-08-25 19:44:11,750 - INFO - Content read successfully. Size: 9553135 bytes
2025-08-25 19:44:11,751 - INFO - Creating BytesIO object...
2025-08-25 19:44:11,752 - INFO - BytesIO object created successfully
2025-08-25 19:44:11,752 - INFO - Validating ZIP format...
2025-08-25 19:44:11,752 - INFO - ZIP format validation passed
2025-08-25 19:44:11,752 - INFO - File pointer reset to beginning
2025-08-25 19:44:11,752 - INFO - Opening ZIP file...
2025-08-25 19:44:11,753 - INFO - ZIP file opened. Number of files: 2
2025-08-25 19:44:11,753 - INFO - ZIP file list: ['6292393310444_0002.jpg', 'closeup(1).jpg']...
2025-08-25 19:44:11,753 - INFO - Testing ZIP integrity...
2025-08-25 19:44:11,756 - INFO - ZIP integrity test passed
2025-08-25 19:44:11,756 - INFO - Extracting to: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/input_images
2025-08-25 19:44:11,768 - INFO - Successfully extracted input.zip to /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/input_images
2025-08-25 19:44:11,768 - INFO - Extracted files: ['6292393310444_0002.jpg', 'closeup(1).jpg']
2025-08-25 19:44:11,768 - INFO - === ZIP EXTRACTION COMPLETED SUCCESSFULLY ===
2025-08-25 19:44:11,769 - INFO - Images ZIP extracted successfully to: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/input_images
2025-08-25 19:44:11,769 - INFO - Attempting to extract masks ZIP: input_processed.zip
2025-08-25 19:44:11,769 - INFO - === ZIP EXTRACTION START ===
2025-08-25 19:44:11,769 - INFO - Filename: input_processed.zip
2025-08-25 19:44:11,770 - INFO - Content type: application/zip
2025-08-25 19:44:11,770 - INFO - File size: 171778
2025-08-25 19:44:11,770 - INFO - Reading file content...
2025-08-25 19:44:11,770 - INFO - Content read successfully. Size: 171778 bytes
2025-08-25 19:44:11,770 - INFO - Creating BytesIO object...
2025-08-25 19:44:11,770 - INFO - BytesIO object created successfully
2025-08-25 19:44:11,770 - INFO - Validating ZIP format...
2025-08-25 19:44:11,770 - INFO - ZIP format validation passed
2025-08-25 19:44:11,770 - INFO - File pointer reset to beginning
2025-08-25 19:44:11,770 - INFO - Opening ZIP file...
2025-08-25 19:44:11,770 - INFO - ZIP file opened. Number of files: 2
2025-08-25 19:44:11,770 - INFO - ZIP file list: ['6292393310444_0002.jpg', 'closeup(1).jpg']...
2025-08-25 19:44:11,770 - INFO - Testing ZIP integrity...
2025-08-25 19:44:11,772 - INFO - ZIP integrity test passed
2025-08-25 19:44:11,772 - INFO - Extracting to: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/masks
2025-08-25 19:44:11,775 - INFO - Successfully extracted input_processed.zip to /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/masks
2025-08-25 19:44:11,775 - INFO - Extracted files: ['6292393310444_0002.jpg', 'closeup(1).jpg']
2025-08-25 19:44:11,775 - INFO - === ZIP EXTRACTION COMPLETED SUCCESSFULLY ===
2025-08-25 19:44:11,775 - INFO - Masks ZIP extracted successfully to: /var/folders/c1/ldxrmn552j738t4qrsd_czr40000gn/T/tmpfopf6nws/masks
2025-08-25 19:44:11,775 - INFO - Reading and validating prompts JSON...
2025-08-25 19:44:11,775 - INFO - Prompts JSON content length: 1379 bytes
2025-08-25 19:44:11,775 - INFO - Converting list format to dictionary format...
2025-08-25 19:44:11,775 - INFO - Converted nested item for product 6292393310444
2025-08-25 19:44:11,775 - INFO - Converted 1 list items to dictionary format
2025-08-25 19:44:11,775 - INFO - Prompts JSON parsed successfully. Number of products: 1
2025-08-25 19:44:11,776 - INFO - Product IDs: ['6292393310444']
2025-08-25 19:44:11,776 - INFO - Loading workflow configuration...
2025-08-25 19:44:11,777 - INFO - Workflow configuration loaded successfully
2025-08-25 19:44:11,777 - INFO - Starting synchronous image processing...
2025-08-25 19:44:11,777 - INFO - ComfyUI URL: https://349405dc2eb3.ngrok-free.app
2025-08-25 19:44:11,777 - INFO - Input directory contents: ['6292393310444_0002.jpg', 'closeup(1).jpg']
2025-08-25 19:44:11,777 - INFO - Masks directory contents: ['6292393310444_0002.jpg', 'closeup(1).jpg']
2025-08-25 19:44:11,777 - INFO - Starting image processing - this will wait for ComfyUI to complete ALL images...
2025-08-25 19:44:11,778 - INFO - Starting to process images...
2025-08-25 19:44:11,778 - INFO - Attempting to upload background image to ComfyUI server: https://349405dc2eb3.ngrok-free.app
2025-08-25 19:44:12,848 - INFO - Uploaded WhiteBackground_Template.png as WhiteBackground_Template_20250825_194411_2fe2da45.png (Content-Type: image/png)
2025-08-25 19:44:12,850 - INFO - Found 1 unique style images referenced in prompts.json
2025-08-25 19:44:12,850 - INFO - Required style images: Urban street
2025-08-25 19:44:12,851 - INFO - Found matching files for all 1 required style images
2025-08-25 19:44:12,851 - INFO - Uploading required style image: Urban street.jpg -> Urban street
2025-08-25 19:44:13,615 - INFO - Uploaded Urban street.jpg as Urban street_20250825_194412_5ebe665a.jpg (Content-Type: image/jpeg)
2025-08-25 19:44:13,618 - INFO - Successfully uploaded style image for 'Urban street'
2025-08-25 19:44:13,618 - INFO - Successfully uploaded all 1 required style images
2025-08-25 19:44:13,618 - INFO - Processing product ID: 6292393310444
2025-08-25 19:44:13,618 - INFO - Processing product 6292393310444 (1/1) - Progress: 100%
2025-08-25 19:44:13,618 - INFO - Looking for style image: Urban street
2025-08-25 19:44:13,618 - WARNING - Product directories not found for 6292393310444
2025-08-25 19:44:13,618 - WARNING - Input folder contents: ['6292393310444_0002.jpg', 'closeup(1).jpg']
2025-08-25 19:44:13,619 - WARNING - Mask folder contents: ['6292393310444_0002.jpg', 'closeup(1).jpg']
2025-08-25 19:44:13,619 - INFO - Processing completed successfully!
2025-08-25 19:44:13,619 - INFO - Total products processed: 1
2025-08-25 19:44:13,619 - INFO - Successful images: 0
2025-08-25 19:44:13,619 - INFO - Failed images: 0
2025-08-25 19:44:13,619 - ERROR - Fatal error during processing: No images were successfully processed
2025-08-25 19:44:13,619 - ERROR - Image processing failed: No images were successfully processed
2025-08-25 19:44:13,622 - INFO - Temporary directory cleaned up
2025-08-25 19:44:13,622 - ERROR - Unexpected error in process_images endpoint: 
2025-08-25 19:44:13,623 - ERROR - Error type: HTTPException
2025-08-25 19:44:13,627 - ERROR - Traceback: Traceback (most recent call last):
  File "/Users/apple/Desktop/Automation Dashboard API/Final Workflow n8n Working/api.py", line 811, in process_images
    process_images_api(
  File "/Users/apple/Desktop/Automation Dashboard API/Final Workflow n8n Working/api.py", line 686, in process_images_api
    raise Exception("No images were successfully processed")
Exception: No images were successfully processed

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Users/apple/Desktop/Automation Dashboard API/Final Workflow n8n Working/api.py", line 823, in process_images
    raise HTTPException(status_code=500, detail=f"Image processing failed: {str(e)}")
fastapi.exceptions.HTTPException

